#!/bin/bash

# Build 7.4 from source.
# We get our source from a github mirror (the original source is in
# Mercurial)
#
# If the source is already present, we'll do a git pull first.
#

function errExit {
	echo "ERROR: $@"
	exit 1
}

isDebian=false
if which apt-get &>/dev/null; then
	isDebian=true
fi

if [[ -z $sourceMe ]]; then
	pkgList="libncurses5-dev libgnome2-dev libgnomeui-dev libgtk2.0-dev libatk1.0-dev libbonoboui2-dev libcairo2-dev libx11-dev libxpm-dev libxt-dev"
	if $isDebian; then
		sudo apt-get install "$pkgList" || errExit "apt-get failed"
	else
		# yum we assume
		which yum || errExit "yum not installed"
		yum install -y $pkgList || errExit "yum install failed"
	fi
	# Do we have the source?
	if [[ ! -d $HOME/vimsrc ]]; then
		mkdir $HOME/vimsrc -p || errExit ""
	fi
	cd $HOME/vimsrc
	if [[ ! -d .git ]]; then
		rm -rf *
		git clone https://github.com/b4winckler/vim.git ./ || errExit "git clone failed"
	fi
	git pull || errExit "git pull failed"

	cd src
	make distclean || errExit "distclean failed"
	./configure --with-features=huge --enable-gui=gnome2 || errExit "configure failed"
	make || errExit "make failed"
	sudo make install || errExit "make install failed"

fi
